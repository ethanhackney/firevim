fold linkMode into regular mode handling
input mode still having problems
